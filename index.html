<!DOCTYPE html>
<html>
<head>
    <title>3D Heart to Rose</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; }
        canvas { display: block; }
        #info { 
            position: absolute; top: 20px; width: 100%; text-align: center; 
            color: #ffb6c1; font-family: 'Arial', sans-serif; pointer-events: none;
            text-shadow: 0 0 15px #ff69b4; font-size: 14px; letter-spacing: 2px;
        }
    </style>
</head>
<body>
    <div id="info">TAP UNTUK TRANSFORMASI<br>HATI PINK &rarr; MAWAR MERAH</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js"></script>

    <script>
        let scene, camera, renderer, points;
        const particleCount = 12000; 
        let heartCoords = [];
        let roseCoords = [];
        let isRose = false;

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.z = 18;

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // 1. Koordinat Hati Pink (3D Mathematical Heart)
            for (let i = 0; i < particleCount; i++) {
                const phi = Math.random() * Math.PI * 2;
                const theta = Math.random() * Math.PI;
                // Rumus Jantung 3D yang lebih tebal
                const x = 16 * Math.pow(Math.sin(phi), 3) * Math.sin(theta);
                const y = (13 * Math.cos(phi) - 5 * Math.cos(2*phi) - 2 * Math.cos(3*phi) - Math.cos(4*phi)) * Math.sin(theta);
                const z = 8 * Math.cos(theta);
                heartCoords.push(x * 0.4, y * 0.4, z * 0.4);
            }

            // 2. Koordinat Mawar (Detailed Rose Spiral)
            for (let i = 0; i < particleCount; i++) {
                const t = (i / particleCount) * Math.PI * 30; // spiral kelopak
                const r = 0.5 * Math.sqrt(i) * 0.15;
                const x = r * Math.cos(t) * Math.sin(i);
                const y = r * Math.sin(t) * Math.cos(i) + (Math.pow(r, 1.5) * 0.2); 
                const z = (Math.sin(r) * 2) + (Math.random() * 0.5);
                roseCoords.push(x * 2, y * 2 - 4, z * 2);
            }

            const geometry = new THREE.BufferGeometry();
            const initialPos = new Float32Array(heartCoords);
            geometry.setAttribute('position', new THREE.BufferAttribute(initialPos, 3));

            const material = new THREE.PointsMaterial({
                color: 0xff69b4, 
                size: 0.04,
                transparent: true,
                opacity: 0.9,
                blending: THREE.AdditiveBlending
            });

            points = new THREE.Points(geometry, material);
            scene.add(points);

            // Event Listeners
            window.addEventListener('click', morph);
            window.addEventListener('touchstart', (e) => { e.preventDefault(); morph(); });
        }

        function morph() {
            const target = isRose ? heartCoords : roseCoords;
            const posAttr = points.geometry.attributes.position;
            
            for (let i = 0; i < particleCount; i++) {
                gsap.to(posAttr.array, {
                    [i * 3]: target[i * 3],
                    [i * 3 + 1]: target[i * 3 + 1],
                    [i * 3 + 2]: target[i * 3 + 2],
                    duration: 2.5,
                    ease: "power4.inOut",
                    onUpdate: () => posAttr.needsUpdate = true
                });
            }
            
            // Transisi Warna: Pink (Hati) ke Merah Tua (Mawar)
            gsap.to(points.material.color, {
                r: isRose ? 1.0 : 0.8,
                g: isRose ? 0.4 : 0.0,
                b: isRose ? 0.7 : 0.1,
                duration: 2
            });

            isRose = !isRose;
        }

        function animate() {

