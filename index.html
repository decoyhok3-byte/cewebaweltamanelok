<!DOCTYPE html>
<html>
<head>
    <title>3D Heart to Rose Morphing</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        canvas { display: block; }
        #info { position: absolute; top: 10px; width: 100%; text-align: center; color: #ff69b4; font-family: 'Segoe UI', sans-serif; pointer-events: none; text-shadow: 0 0 10px #ff1493; }
    </style>
</head>
<body>
    <div id="info">Ketuk Layar: Hati Pink &rarr; Mawar 3D</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js"></script>

    <script>
        let scene, camera, renderer, points;
        const particleCount = 10000; // Ditambah agar lebih detail
        let heartCoords = [];
        let roseCoords = [];
        let isRose = false;

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.z = 15;

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // 1. Koordinat Hati Pink (3D Heart Formula)
            for (let i = 0; i < particleCount; i++) {
                const t = Math.random() * Math.PI * 2;
                const p = Math.random() * Math.PI;
                // Rumus Hati 3D
                const x = 16 * Math.pow(Math.sin(t), 3) * Math.sin(p);
                const y = (13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)) * Math.sin(p);
                const z = 8 * Math.cos(p);
                heartCoords.push(x * 0.3, y * 0.3, z * 0.3);
            }

            // 2. Koordinat Mawar (Rose Curve/Spherical Harmonics style)
            for (let i = 0; i < particleCount; i++) {
                const t = (i / particleCount) * Math.PI * 20; // spiral
                const r = 5 * Math.sin(0.5 * t);
                const x = r * Math.cos(t) * (1 - i/particleCount);
                const y = r * Math.sin(t) * (1 - i/particleCount) + (i/particleCount * 5); // batang/pusat
                const z = 2 * Math.cos(t * 0.5) + (Math.random() - 0.5);
                roseCoords.push(x, y - 2, z);
            }

            const geometry = new THREE.BufferGeometry();
            const initialPos = new Float32Array(heartCoords);
            geometry.setAttribute('position', new THREE.BufferAttribute(initialPos, 3));

            const material = new THREE.PointsMaterial({
                color: 0xff69b4, // Hot Pink
                size: 0.04,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });

            points = new THREE.Points(geometry, material);
            scene.add(points);

            window.addEventListener('click', morph);
            window.addEventListener('touchstart', morph);
        }

        function morph() {
            const target = isRose ? heartCoords : roseCoords;
            const posAttr = points.geometry.attributes.position;
            
            // Animasi transisi posisi
            for (let i = 0; i < particleCount; i++) {
                gsap.to(posAttr.array, {
                    [i * 3]: target[i * 3],
                    [i * 3 + 1]: target[i * 3 + 1],
                    [i * 3 + 2]: target[i * 3 + 2],
                    duration: 2.5,
                    ease: "expo.inOut",
                    onUpdate: () => posAttr.needsUpdate = true
                });
            }
            
            // Perubahan warna: Pink cerah (Hati) ke Merah Mawar (Mawar)
            gsap.to(points.material.color, {
                r: isRose ? 1 : 0.9,
                g: isRose ? 0.4 : 0.0,
                b: isRose ? 0.7 : 0.1,
                duration: 2
            });

            isRose = !isRose;
        }

        function animate() {
            requestAnimationFrame(animate);
            points.rotation.y += 0.01;
            renderer.render(scene, camera);
        }

        // Responsif saat layar diputar/resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
